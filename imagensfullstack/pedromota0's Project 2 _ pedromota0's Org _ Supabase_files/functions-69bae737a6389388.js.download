!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="d2b4dbe7-79b4-4cf2-abfe-d204b2af0ec6",e._sentryDebugIdIdentifier="sentry-dbid-d2b4dbe7-79b4-4cf2-abfe-d204b2af0ec6")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8447],{20071:function(e,t,n){var s=n(29233);e.exports=function(e,t){return s(t,function(t){return e[t]})}},42876:function(e,t,n){var s=n(94365),a=n(30568),r=n(76705),i=n(46743),l=n(31682),o=Math.max;e.exports=function(e,t,n,c){e=a(e)?e:l(e),n=n&&!c?i(n):0;var d=e.length;return n<0&&(n=o(d+n,0)),r(e)?n<=d&&e.indexOf(t,n)>-1:!!d&&s(e,t,n)>-1}},31682:function(e,t,n){var s=n(20071),a=n(62096);e.exports=function(e){return null==e?[]:s(e,a(e))}},59466:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/database/functions",function(){return n(17122)}])},9438:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(96813).Z)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]])},32073:function(e,t,n){"use strict";n.d(t,{p:function(){return i}});var s=n(97458),a=n(28453),r=n(44658);let i=e=>{let{title:t,description:n,docsUrl:i,actions:l,className:o}=e;return(0,s.jsxs)("div",{className:(0,a.cn)("w-full mb-6 flex flex-col sm:flex-row md:items-center justify-between gap-4 ".concat(o)),"data-sentry-component":"FormHeader","data-sentry-source-file":"FormHeader.tsx",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("h3",{className:"text-foreground text-xl prose",children:t}),n&&(0,s.jsx)("div",{className:"prose text-sm max-w-full",children:n})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row md:items-center gap-x-2",children:[void 0!==i&&(0,s.jsx)(r.G,{href:i}),l]})]})}},54599:function(e,t,n){"use strict";var s=n(97458),a=n(18178);t.Z=e=>{let{resourceText:t,isFullPage:n=!1}=e,r=()=>(0,s.jsx)("div",{className:"block w-full rounded border border-opacity-20 py-4 px-6 border-overlay bg-surface-200","data-sentry-component":"NoPermissionMessage","data-sentry-source-file":"NoPermission.tsx",children:(0,s.jsxs)("div",{className:"flex space-x-3",children:[(0,s.jsx)("div",{className:"mt-1",children:(0,s.jsx)(a.Z,{size:20,"data-sentry-element":"AlertCircle","data-sentry-source-file":"NoPermission.tsx"})}),(0,s.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("p",{className:"text-sm",children:["You need additional permissions to ",t]}),(0,s.jsx)("div",{children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Contact your organization owner or administrator for assistance."})})]})})]})});return n?(0,s.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,s.jsx)("div",{className:"w-[550px]",children:(0,s.jsx)(r,{})})}):(0,s.jsx)(r,{})}},17122:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return K}});var s=n(97458),a=n(40540),r=n(52983),i=n(85741),l=n(9981),o=n(71607),c=n.n(o),d=n(50663),u=n.n(d),x=n(96012),f=n(48426),m=n(65483),h=n(59185),p=n(92796),j=n(51002),g=n(11426),b=n(556),v=n(50761),y=n(79302),N=n(85617),w=n(90825),S=n(66092),C=n(9258),Z=n(79133),_=n(62066),F=n(93658),T=n(98291),R=n(16795),L=n(42876),k=n.n(L),D=n(71635),E=n.n(D),P=n(43749),A=n(60888),I=n(9438),z=n(75635),M=n(11801),V=n(97380),U=n(15357),X=e=>{let{schema:t,filterString:n,isLocked:r,editFunction:i=c(),deleteFunction:l=c()}=e,o=(0,f.useRouter)(),{project:d}=(0,h.d2)(),u=(0,_.oJ)(),{data:x}=(0,N.R)({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString}),m=(null!=x?x:[]).filter(e=>k()(e.name.toLowerCase(),n.toLowerCase())),p=E()(m.filter(e=>e.schema==t),e=>e.name.toLocaleLowerCase()),g=null==d?void 0:d.ref,v=(0,S.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"functions");return 0===p.length&&0===n.length?(0,s.jsx)(j.Z.tr,{children:(0,s.jsxs)(j.Z.td,{colSpan:5,children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No functions created yet"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no functions found in the schema "',t,'"']})]})},t):0===p.length&&n.length>0?(0,s.jsx)(j.Z.tr,{children:(0,s.jsxs)(j.Z.td,{colSpan:5,children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',n,'" did not return any results']})]})},t):(0,s.jsx)(s.Fragment,{children:p.map(e=>{let n="public"==t&&"trigger"!==e.return_type;return(0,s.jsxs)(j.Z.tr,{children:[(0,s.jsx)(j.Z.td,{className:"truncate",children:(0,s.jsx)(V.z,{type:"text",className:"text-foreground text-sm p-0 hover:bg-transparent",onClick:()=>i(e),children:e.name})}),(0,s.jsx)(j.Z.td,{className:"table-cell overflow-auto",children:(0,s.jsx)("p",{title:e.argument_types,className:"truncate",children:e.argument_types||"-"})}),(0,s.jsx)(j.Z.td,{className:"table-cell",children:(0,s.jsx)("p",{title:e.return_type,children:e.return_type})}),(0,s.jsx)(j.Z.td,{className:"table-cell",children:e.security_definer?"Definer":"Invoker"}),(0,s.jsx)(j.Z.td,{className:"text-right",children:!r&&(0,s.jsx)("div",{className:"flex items-center justify-end",children:v?(0,s.jsxs)(U.h_,{children:[(0,s.jsx)(U.$F,{asChild:!0,children:(0,s.jsx)(V.z,{type:"default",className:"px-1",icon:(0,s.jsx)(P.Z,{})})}),(0,s.jsxs)(U.AW,{side:"left",className:"w-52",children:[n&&(0,s.jsxs)(U.Xi,{className:"space-x-2",onClick:()=>o.push("/project/".concat(g,"/api?rpc=").concat(e.name)),children:[(0,s.jsx)(A.Z,{size:14}),(0,s.jsx)("p",{children:"Client API docs"})]}),(0,s.jsxs)(U.Xi,{className:"space-x-2",onClick:()=>i(e),children:[(0,s.jsx)(I.Z,{size:14}),(0,s.jsx)("p",{children:"Edit function"})]}),(0,s.jsxs)(U.Xi,{className:"space-x-2",onClick:()=>{u.newChat({name:"Update function ".concat(e.name),open:!0,initialInput:"Update this function to do...",suggestions:{title:"I can help you make a change to this function, here are a few example prompts to get you started:",prompts:["Rename this function to ...","Modify this function so that it ...","Add a trigger for this function that calls it when ..."]},sqlSnippets:[e.complete_statement]})},children:[(0,s.jsx)(z.Z,{size:14}),(0,s.jsx)("p",{children:"Edit function with Assistant"})]}),(0,s.jsx)(U.VD,{}),(0,s.jsxs)(U.Xi,{className:"space-x-2",onClick:()=>l(e),children:[(0,s.jsx)(M.Z,{size:14,className:"text-destructive"}),(0,s.jsx)("p",{children:"Delete function"})]})]})]}):(0,s.jsx)(b.u,{disabled:!0,type:"default",icon:(0,s.jsx)(P.Z,{}),className:"px-1",tooltip:{content:{side:"left",text:"You need additional permissions to update functions"}}})})})]},e.id)})})},O=e=>{let{createFunction:t=c(),editFunction:n=c(),deleteFunction:r=c()}=e,i=(0,f.useRouter)(),{search:l}=(0,m.UO)(),{project:o}=(0,h.d2)(),d=(0,_.oJ)(),{selectedSchema:L,setSelectedSchema:k}=(0,C.B)(),D=null!=l?l:"",E=e=>{let t=new URL(document.URL);""===e?t.searchParams.delete("search"):t.searchParams.set("search",e),i.push(t)},P=(0,S.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"functions"),{data:A}=(0,w.Q1)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString}),[I]=u()(null!=A?A:[],e=>{var t;return Z.s.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),z=null==A?void 0:A.find(e=>e.name===L),M=I.some(e=>e.id===(null==z?void 0:z.id)),{data:V,error:U,isLoading:O,isError:H}=(0,N.R)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString});return O?(0,s.jsx)(y.A,{}):H?(0,s.jsx)(g.Z,{error:U,subject:"Failed to retrieve database functions"}):(0,s.jsx)(s.Fragment,{children:0==(null!=V?V:[]).length?(0,s.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,s.jsxs)(p.Z,{title:"Functions",ctaButtonLabel:"Create a new function",onClickCta:()=>t(),disabled:!P,disabledMessage:"You need additional permissions to create functions",children:[(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"PostgreSQL functions, also known as stored procedures, is a set of SQL and procedural commands such as declarations, assignments, loops, flow-of-control, etc."}),(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"It's stored on the database server and can be invoked using the SQL interface."})]})}):(0,s.jsxs)("div",{className:"w-full space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-2 flex-wrap",children:[(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center gap-2",children:[(0,s.jsx)(v.Z,{className:"w-full lg:w-[180px]",size:"tiny",showError:!1,selectedSchemaName:L,onSelectSchema:e=>{let t=new URL(document.URL);t.searchParams.delete("search"),i.push(t),k(e)}}),(0,s.jsx)(F.Z,{placeholder:"Search for a function",size:"tiny",icon:(0,s.jsx)(x.Z,{size:14}),value:D,className:"w-full lg:w-52",onChange:e=>E(e.target.value)})]}),(0,s.jsx)("div",{className:"flex items-center gap-x-2",children:!M&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.u,{disabled:!P,onClick:()=>t(),className:"flex-grow",tooltip:{content:{side:"bottom",text:P?void 0:"You need additional permissions to create functions"}},children:"Create a new function"}),(0,s.jsx)(b.u,{type:"default",disabled:!P,className:"px-1 pointer-events-auto",icon:(0,s.jsx)(T.c,{size:16}),onClick:()=>d.newChat({name:"Create new function",open:!0,initialInput:"Create a new function for the schema ".concat(L," that does ...")}),tooltip:{content:{side:"bottom",text:P?"Create with Supabase Assistant":"You need additional permissions to create functions"}}})]})})]}),M&&(0,s.jsx)(R.Z,{schema:L,entity:"functions"}),(0,s.jsx)(j.Z,{className:"table-fixed overflow-x-auto",head:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.Z.th,{children:"Name"},"name"),(0,s.jsx)(j.Z.th,{className:"table-cell",children:"Arguments"},"arguments"),(0,s.jsx)(j.Z.th,{className:"table-cell",children:"Return type"},"return_type"),(0,s.jsx)(j.Z.th,{className:"table-cell w-[100px]",children:"Security"},"security"),(0,s.jsx)(j.Z.th,{className:"w-1/6"},"buttons")]}),body:(0,s.jsx)(X,{schema:L,filterString:D,isLocked:M,editFunction:n,deleteFunction:r})})]})})},H=n(30530),B=n(30578),Q=n(43391),Y=n(32073),W=n(54599),$=n(79364);let J=()=>{let[e,t]=(0,r.useState)(),[n,o]=(0,r.useState)(!1),[c,d]=(0,r.useState)(!1),{setEditorPanel:u}=(0,$.WZ)(),x=(0,i.uL)(),f=(0,S.Xo)(a.KA.TENANT_SQL_ADMIN_READ,"functions");return(0,S.N4)()&&!f?(0,s.jsx)(W.Z,{isFullPage:!0,resourceText:"view database functions"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Q._S,{"data-sentry-element":"ScaffoldContainer","data-sentry-source-file":"functions.tsx",children:(0,s.jsx)(Q.jX,{"data-sentry-element":"ScaffoldSection","data-sentry-source-file":"functions.tsx",children:(0,s.jsxs)("div",{className:"col-span-12",children:[(0,s.jsx)(Y.p,{title:"Database Functions",docsUrl:"https://supabase.com/docs/guides/database/functions","data-sentry-element":"FormHeader","data-sentry-source-file":"functions.tsx"}),(0,s.jsx)(O,{createFunction:()=>{x?u({open:!0,initialValue:"create function function_name()\nreturns void\nlanguage plpgsql\nas $$\nbegin\n  -- Write your function logic here\nend;\n$$;",label:"Create new database function",saveLabel:"Create function",initialPrompt:"Create a new database function that..."}):(t(void 0),o(!0))},editFunction:e=>{x?u({open:!0,initialValue:e.complete_statement,label:'Edit function "'.concat(e.name,'"'),saveLabel:"Update function",initialPrompt:'Update the database function "'.concat(e.name,'" to...')}):(t(e),o(!0))},deleteFunction:e=>{t(e),d(!0)},"data-sentry-element":"FunctionsList","data-sentry-source-file":"functions.tsx"})]})})}),(0,s.jsx)(l.B8,{func:e,visible:n,setVisible:o,"data-sentry-element":"CreateFunction","data-sentry-source-file":"functions.tsx"}),(0,s.jsx)(l.ZR,{func:e,visible:c,setVisible:d,"data-sentry-element":"DeleteFunction","data-sentry-source-file":"functions.tsx"})]})};J.getLayout=e=>(0,s.jsx)(B.Z,{children:(0,s.jsx)(H.Z,{title:"Database",children:e})});var K=J},98419:function(e,t,n){"use strict";n.d(t,{c:function(){return g},w:function(){return h}});var s=n(97458),a=n(52983),r=n(76028),i=n(28453),l=n(28977),o=n.n(l),c=n(60192),d=n.n(c),u=n(13516),x=n.n(u);o().extend(d()),o().extend(x());let f=e=>o().unix(Number(e)/1e3/1e3).toISOString(),m=e=>{let t=16===String(e).length;return!Number.isNaN(Number(e))&&t},h=e=>{let{utcTimestamp:t,format:n}=e,s=m(t)?f(t):t;return o().utc(s).local().format(n)},p=e=>{let{utcTimestamp:t,format:n}=e,s=m(t)?f(t):t;return o().utc(s).format(n)},j=e=>{let{utcTimestamp:t}=e,n=m(t)?f(t):t;return o().utc(n).fromNow()},g=e=>{let{utcTimestamp:t,className:n,displayAs:l="local",format:o="DD MMM  HH:mm:ss",labelFormat:c="DD MMM HH:mm:ss"}=e,d=h({utcTimestamp:t,format:o}),u=p({utcTimestamp:t,format:o}),x=j({utcTimestamp:t}),[f,m]=(0,a.useState)("start"),g=(0,a.useRef)(null),b=Intl.DateTimeFormat().resolvedOptions().timeZone;(0,a.useEffect)(()=>{let e=()=>{if(g.current){let e=g.current.getBoundingClientRect(),t=window.innerHeight;m(e.top<t/2?"start":"end")}};return e(),window.addEventListener("scroll",e),window.addEventListener("resize",e),()=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e)}},[]);let v=e=>{let{label:t,value:n}=e,[r,l]=(0,a.useState)(!1);return(0,s.jsxs)("div",{onPointerDown:e=>{e.stopPropagation()},onMouseDown:e=>{e.stopPropagation()},onClick:e=>{e.stopPropagation(),e.preventDefault(),navigator.clipboard.writeText(n),l(!0),setTimeout(()=>{l(!1)},1e3)},className:(0,i.cn)("relative cursor-pointer flex gap-y-2 gap-x-0.5 hover:bg-surface-100 px-2 py-1 group",{"bg-surface-100":r}),"data-sentry-component":"TooltipRow","data-sentry-source-file":"index.tsx",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-2 text-left truncate",children:[(0,s.jsx)("p",{children:t}),(0,s.jsx)("div",{className:"border-t w-full border-dashed"})]}),(0,s.jsxs)("div",{className:"relative flex items-center gap-x-2 flex-grow",children:[(0,s.jsx)("div",{className:"border-t w-full border-dashed z-10"}),r&&(0,s.jsx)("span",{className:"flex items-center justify-end w-full absolute inset-0 flex items-right text-brand-600 bg-surface-100",children:"Copied!"}),(0,s.jsx)("span",{className:"flex items-center gap-x-2 justify-end whitespace-nowrap",children:n})]})]})};return(0,s.jsxs)(r.u,{"data-sentry-element":"Tooltip","data-sentry-component":"TimestampInfo","data-sentry-source-file":"index.tsx",children:[(0,s.jsx)(r.aJ,{asChild:!0,ref:g,className:"text-xs ".concat(n," border-b border-transparent hover:border-dashed hover:border-foreground-light"),"data-sentry-element":"TooltipTrigger","data-sentry-source-file":"index.tsx",children:(0,s.jsx)("span",{children:"local"===l?h({utcTimestamp:t,format:c}):p({utcTimestamp:t,format:c})})}),(0,s.jsxs)(r._v,{align:f,side:"right",className:"font-mono p-0 py-1 min-w-80","data-sentry-element":"TooltipContent","data-sentry-source-file":"index.tsx",children:[(0,s.jsx)(v,{label:"UTC",value:u,"data-sentry-element":"TooltipRow","data-sentry-source-file":"index.tsx"}),(0,s.jsx)(v,{label:b,value:d,"data-sentry-element":"TooltipRow","data-sentry-source-file":"index.tsx"}),(0,s.jsx)(v,{label:"Relative",value:x,"data-sentry-element":"TooltipRow","data-sentry-source-file":"index.tsx"}),(0,s.jsx)(v,{label:"Timestamp",value:String(t),"data-sentry-element":"TooltipRow","data-sentry-source-file":"index.tsx"})]})]})}},8209:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var s=n(97458),a=n(52983),r=n(81604),i=n(91416);function l(e,t){if(!t.error)return delete e[t.key],e;if(t)return{...e,[t.key]:t.error};throw Error()}function o(e){let{validate:t,...n}=e,[o,c]=(0,a.useReducer)(l,null),d=(0,r.TA)({validateOnBlur:!0,...n,validationSchema:n.validationSchema,initialValues:n.initialValues,onSubmit:n.onSubmit,validate:t||function(){return o}});return(0,s.jsx)("form",{id:n.id,name:n.name,onSubmit:d.handleSubmit,className:n.className,style:n.style,method:"POST","data-sentry-component":"Form","data-sentry-source-file":"Form.tsx",children:(0,s.jsx)(i.o,{values:d.values,errors:d.errors,formContextOnChange:d.handleChange,handleBlur:d.handleBlur,touched:d.touched,fieldLevelValidation:function(e,t){c({key:e,error:t})},"data-sentry-element":"FormContextProvider","data-sentry-source-file":"Form.tsx",children:n.children({errors:d.errors,touched:d.touched,isSubmitting:d.isSubmitting,isValidating:d.isValidating,submitCount:d.submitCount,initialValues:d.initialValues,values:d.values,handleReset:d.handleReset,resetForm:d.resetForm,setFieldValue:d.setFieldValue})})})}}},function(e){e.O(0,[6665,3659,7186,3856,6664,588,7037,4605,950,292,2433,7639,3662,436,5582,2585,3356,2269,2019,4637,3545,1604,5538,9710,5686,3829,578,28,7788,7712,7824,2634,9774,2888,179],function(){return e(e.s=59466)}),_N_E=e.O()}]);