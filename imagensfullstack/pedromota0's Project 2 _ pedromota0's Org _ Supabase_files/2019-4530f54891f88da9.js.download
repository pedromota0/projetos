!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="774404eb-e42d-4654-81d6-893f88c3dd61",e._sentryDebugIdIdentifier="sentry-dbid-774404eb-e42d-4654-81d6-893f88c3dd61")}catch(e){}}(),(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2019],{90318:function(e,t,r){"use strict";var o=r(15313).Buffer;let n=void 0!==o,a=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,l=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function s(e,t,r){null==r&&null!==t&&"object"==typeof t&&(r=t,t=void 0),n&&o.isBuffer(e)&&(e=e.toString()),e&&65279===e.charCodeAt(0)&&(e=e.slice(1));let s=JSON.parse(e,t);if(null===s||"object"!=typeof s)return s;let c=r&&r.protoAction||"error",u=r&&r.constructorAction||"error";if("ignore"===c&&"ignore"===u)return s;if("ignore"!==c&&"ignore"!==u){if(!1===a.test(e)&&!1===l.test(e))return s}else if("ignore"!==c&&"ignore"===u){if(!1===a.test(e))return s}else if(!1===l.test(e))return s;return i(s,{protoAction:c,constructorAction:u,safe:r&&r.safe})}function i(e,{protoAction:t="error",constructorAction:r="error",safe:o}={}){let n=[e];for(;n.length;){let e=n;for(let a of(n=[],e)){if("ignore"!==t&&Object.prototype.hasOwnProperty.call(a,"__proto__")){if(!0===o)return null;if("error"===t)throw SyntaxError("Object contains forbidden prototype property");delete a.__proto__}if("ignore"!==r&&Object.prototype.hasOwnProperty.call(a,"constructor")&&Object.prototype.hasOwnProperty.call(a.constructor,"prototype")){if(!0===o)return null;if("error"===r)throw SyntaxError("Object contains forbidden prototype property");delete a.constructor}for(let e in a){let t=a[e];t&&"object"==typeof t&&n.push(t)}}}return e}function c(e,t,r){let o=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return s(e,t,r)}finally{Error.stackTraceLimit=o}}e.exports=c,e.exports.default=c,e.exports.parse=c,e.exports.safeParse=function(e,t){let r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return s(e,t,{safe:!0})}catch(e){return null}finally{Error.stackTraceLimit=r}},e.exports.scan=i},32631:function(e){e.exports=function(e,t){let r;if("function"!=typeof e)throw TypeError(`Expected the first argument to be a \`function\`, got \`${typeof e}\`.`);let o=0;return function(...n){clearTimeout(r);let a=Date.now(),l=t-(a-o);l<=0?(o=a,e.apply(this,n)):r=setTimeout(()=>{o=Date.now(),e.apply(this,n)},l)}}},36482:function(e,t,r){"use strict";var o=r(52983),n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=o.useState,l=o.useEffect,s=o.useLayoutEffect,i=o.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!n(e,r)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),o=a({inst:{value:r,getSnapshot:t}}),n=o[0].inst,u=o[1];return s(function(){n.value=r,n.getSnapshot=t,c(n)&&u({inst:n})},[e,r,t]),l(function(){return c(n)&&u({inst:n}),e(function(){c(n)&&u({inst:n})})},[e]),i(r),r};t.useSyncExternalStore=void 0!==o.useSyncExternalStore?o.useSyncExternalStore:u},1633:function(e,t,r){"use strict";e.exports=r(36482)},42019:function(e,t,r){"use strict";let o;r.d(t,{RJ:function(){return ez},GO:function(){return eH}});var n,a,l=r(52983),s="vercel.ai.error",i=Symbol.for(s),c=class e extends Error{constructor({name:e,message:t,cause:r}){super(t),this[n]=!0,this.name=e,this.cause=r}static isInstance(t){return e.hasMarker(t,s)}static hasMarker(e,t){let r=Symbol.for(t);return null!=e&&"object"==typeof e&&r in e&&"boolean"==typeof e[r]&&!0===e[r]}toJSON(){return{name:this.name,message:this.message}}};n=i;var u=c,d=(Symbol.for("vercel.ai.error.AI_APICallError"),Symbol.for("vercel.ai.error.AI_EmptyResponseBodyError"),"AI_InvalidArgumentError"),f=`vercel.ai.error.${d}`,p=Symbol.for(f),_=class extends u{constructor({message:e,cause:t,argument:r}){super({name:d,message:e,cause:t}),this[a]=!0,this.argument=r}static isInstance(e){return u.hasMarker(e,f)}};a=p,Symbol.for("vercel.ai.error.AI_InvalidPromptError"),Symbol.for("vercel.ai.error.AI_InvalidResponseDataError"),Symbol.for("vercel.ai.error.AI_JSONParseError"),Symbol.for("vercel.ai.error.AI_LoadAPIKeyError"),Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError"),Symbol.for("vercel.ai.error.AI_NoSuchModelError"),Symbol.for("vercel.ai.error.AI_TooManyEmbeddingValuesForCallError"),Symbol.for("vercel.ai.error.AI_TypeValidationError"),Symbol.for("vercel.ai.error.AI_UnsupportedFunctionalityError");let h=(e,t=21)=>(r=t)=>{let o="",n=0|r;for(;n--;)o+=e[Math.random()*e.length|0];return o};var y=r(90318);r(73656);var g=(({prefix:e,size:t=7,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:o="-"}={})=>{let n=h(r,t);if(null==e)return n;if(r.includes(o))throw new _({argument:"separator",message:`The separator "${o}" must not be part of the alphabet "${r}".`});return t=>`${e}${o}${n(t)}`})();Symbol.for("vercel.ai.validator");var{btoa:m,atob:E}=globalThis;Symbol("Let zodToJsonSchema decide on which parser to use");let b=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")};var I={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},v={code:"1",name:"function_call",parse:e=>{if(null==e||"object"!=typeof e||!("function_call"in e)||"object"!=typeof e.function_call||null==e.function_call||!("name"in e.function_call)||!("arguments"in e.function_call)||"string"!=typeof e.function_call.name||"string"!=typeof e.function_call.arguments)throw Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:e}}},w={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},T={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},A={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},R={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},S={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},k={code:"7",name:"tool_calls",parse:e=>{if(null==e||"object"!=typeof e||!("tool_calls"in e)||"object"!=typeof e.tool_calls||null==e.tool_calls||!Array.isArray(e.tool_calls)||e.tool_calls.some(e=>null==e||"object"!=typeof e||!("id"in e)||"string"!=typeof e.id||!("type"in e)||"string"!=typeof e.type||!("function"in e)||null==e.function||"object"!=typeof e.function||!("arguments"in e.function)||"string"!=typeof e.function.name||"string"!=typeof e.function.arguments))throw Error('"tool_calls" parts expect an object with a ToolCallPayload.');return{type:"tool_calls",value:e}}},N={code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},x={code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},C={code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("result"in e))throw Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},O={code:"b",name:"tool_call_streaming_start",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName)throw Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},D={code:"c",name:"tool_call_delta",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("argsTextDelta"in e)||"string"!=typeof e.argsTextDelta)throw Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},L={code:"d",name:"finish_message",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_message" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},F={code:"e",name:"finish_step",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_step" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&"boolean"==typeof e.isContinued&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},j={[I.code]:I,[v.code]:v,[w.code]:w,[T.code]:T,[A.code]:A,[R.code]:R,[S.code]:S,[k.code]:k,[N.code]:N,[x.code]:x,[C.code]:C,[O.code]:O,[D.code]:D,[L.code]:L,[F.code]:F};I.name,I.code,v.name,v.code,w.name,w.code,T.name,T.code,A.name,A.code,R.name,R.code,S.name,S.code,k.name,k.code,N.name,N.code,x.name,x.code,C.name,C.code,O.name,O.code,D.name,D.code,L.name,L.code,F.name,F.code;var V=[I,v,w,T,A,R,S,k,N,x,C,O,D,L,F].map(e=>e.code),M=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let r=e.slice(0,t);if(!V.includes(r))throw Error(`Failed to parse stream string. Invalid code ${r}.`);let o=JSON.parse(e.slice(t+1));return j[r].parse(o)};async function*B(e,{isAborted:t}={}){let r=new TextDecoder,o=[],n=0;for(;;){let{value:a}=await e.read();if(a&&(o.push(a),n+=a.length,10!==a[a.length-1]))continue;if(0===o.length)break;let l=function(e,t){let r=new Uint8Array(t),o=0;for(let t of e)r.set(t,o),o+=t.length;return e.length=0,r}(o,n);for(let e of(n=0,r.decode(l,{stream:!0}).split("\n").filter(e=>""!==e).map(M)))yield e;if(null==t?void 0:t()){e.cancel();break}}}function J(e,t){return e&&t&&t.length?{...e,annotations:[...t]}:e}async function U({reader:e,abortControllerRef:t,update:r,onToolCall:o,onFinish:n,generateId:a=g,getCurrentDate:l=()=>new Date}){var s;let i,c;let u=l(),d={},f=[],p=[],_={},h={completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},m="unknown";for await(let{type:n,value:l}of B(e,{isAborted:()=>(null==t?void 0:t.current)===null})){if("error"===n)throw Error(l);if("finish_step"===n){l.isContinued||(i={});continue}if("finish_message"===n){if(m=l.finishReason,null!=l.usage){let{completionTokens:e,promptTokens:t}=l.usage;h={completionTokens:e,promptTokens:t,totalTokens:e+t}}continue}if(null!=i&&("text"===n||"tool_call"===n||"tool_call_streaming_start"===n||"tool_call_delta"===n||"tool_result"===n)&&(d.text&&f.push(d.text),d.function_call&&f.push(d.function_call),d.tool_calls&&f.push(d.tool_calls),d=i,i=void 0),"text"===n&&(d.text?d.text={...d.text,content:(d.text.content||"")+l}:d.text={id:a(),role:"assistant",content:l,createdAt:u}),"tool_call_streaming_start"===n)null==d.text&&(d.text={id:a(),role:"assistant",content:"",createdAt:u}),null==d.text.toolInvocations&&(d.text.toolInvocations=[]),_[l.toolCallId]={text:"",toolName:l.toolName,prefixMapIndex:d.text.toolInvocations.length},d.text.toolInvocations.push({state:"partial-call",toolCallId:l.toolCallId,toolName:l.toolName,args:void 0});else if("tool_call_delta"===n){let e=_[l.toolCallId];e.text+=l.argsTextDelta;let{value:t}=function(e){if(void 0===e)return{value:void 0,state:"undefined-input"};try{return{value:y.parse(e),state:"successful-parse"}}catch(t){try{return{value:y.parse(function(e){let t=["ROOT"],r=-1,o=null;function n(e,n,a){switch(e){case'"':r=n,t.pop(),t.push(a),t.push("INSIDE_STRING");break;case"f":case"t":case"n":r=n,o=n,t.pop(),t.push(a),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(a),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=n,t.pop(),t.push(a),t.push("INSIDE_NUMBER");break;case"{":r=n,t.pop(),t.push(a),t.push("INSIDE_OBJECT_START");break;case"[":r=n,t.pop(),t.push(a),t.push("INSIDE_ARRAY_START")}}function a(e,o){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":r=o,t.pop()}}function l(e,o){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=o,t.pop()}}for(let s=0;s<e.length;s++){let i=e[s];switch(t[t.length-1]){case"ROOT":n(i,s,"FINISH");break;case"INSIDE_OBJECT_START":switch(i){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":r=s,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===i&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===i&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===i&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":n(i,s,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":a(i,s);break;case"INSIDE_STRING":switch(i){case'"':t.pop(),r=s;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:r=s}break;case"INSIDE_ARRAY_START":"]"===i?(r=s,t.pop()):(r=s,n(i,s,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(i){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=s,t.pop();break;default:r=s}break;case"INSIDE_ARRAY_AFTER_COMMA":n(i,s,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),r=s;break;case"INSIDE_NUMBER":switch(i){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=s;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&l(i,s),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&a(i,s);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&a(i,s);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&l(i,s);break;default:t.pop()}break;case"INSIDE_LITERAL":{let n=e.substring(o,s+1);"false".startsWith(n)||"true".startsWith(n)||"null".startsWith(n)?r=s:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?a(i,s):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&l(i,s))}}}let s=e.slice(0,r+1);for(let r=t.length-1;r>=0;r--)switch(t[r]){case"INSIDE_STRING":s+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":s+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":s+="]";break;case"INSIDE_LITERAL":{let t=e.substring(o,e.length);"true".startsWith(t)?s+="true".slice(t.length):"false".startsWith(t)?s+="false".slice(t.length):"null".startsWith(t)&&(s+="null".slice(t.length))}}return s}(e)),state:"repaired-parse"}}catch(e){}}return{value:void 0,state:"failed-parse"}}(e.text);d.text.toolInvocations[e.prefixMapIndex]={state:"partial-call",toolCallId:l.toolCallId,toolName:e.toolName,args:t},d.text.internalUpdateId=a()}else if("tool_call"===n){if(null!=_[l.toolCallId]?d.text.toolInvocations[_[l.toolCallId].prefixMapIndex]={state:"call",...l}:(null==d.text&&(d.text={id:a(),role:"assistant",content:"",createdAt:u}),null==d.text.toolInvocations&&(d.text.toolInvocations=[]),d.text.toolInvocations.push({state:"call",...l})),d.text.internalUpdateId=a(),o){let e=await o({toolCall:l});null!=e&&(d.text.toolInvocations[d.text.toolInvocations.length-1]={state:"result",...l,result:e})}}else if("tool_result"===n){let e=null==(s=d.text)?void 0:s.toolInvocations;if(null==e)throw Error("tool_result must be preceded by a tool_call");let t=e.findIndex(e=>e.toolCallId===l.toolCallId);if(-1===t)throw Error("tool_result must be preceded by a tool_call with the same toolCallId");e[t]={...e[t],state:"result",...l}}let e=null;"function_call"===n&&(d.function_call={id:a(),role:"assistant",content:"",function_call:l.function_call,name:l.function_call.name,createdAt:u},e=d.function_call);let t=null;"tool_calls"===n&&(d.tool_calls={id:a(),role:"assistant",content:"",tool_calls:l.tool_calls,createdAt:u},t=d.tool_calls),"data"===n&&p.push(...l);let g=d.text;"message_annotations"===n&&(c?c.push(...l):c=[...l],e=J(d.function_call,c),t=J(d.tool_calls,c),g=J(d.text,c),null!=d.text&&(d.text.internalUpdateId=a())),(null==c?void 0:c.length)&&(d.text&&(d.text.annotations=[...c]),d.function_call&&(d.function_call.annotations=[...c]),d.tool_calls&&(d.tool_calls.annotations=[...c])),r([...f,...[e,t,g].filter(Boolean).map(e=>({...J(e,c)}))],[...p])}return null==n||n({message:d.text,finishReason:m,usage:h}),{messages:[d.text,d.function_call,d.tool_calls].filter(Boolean),data:p}}var P=()=>fetch;async function Y({api:e,body:t,streamProtocol:r="data",credentials:o,headers:n,abortController:a,restoreMessagesOnFailure:l,onResponse:s,onUpdate:i,onFinish:c,onToolCall:u,generateId:d,fetch:f=P()}){var p,_;let h=await f(e,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",...n},signal:null==(p=null==a?void 0:a())?void 0:p.signal,credentials:o}).catch(e=>{throw l(),e});if(s)try{await s(h)}catch(e){throw e}if(!h.ok)throw l(),Error(null!=(_=await h.text())?_:"Failed to fetch the chat response.");if(!h.body)throw Error("The response body is empty.");let y=h.body.getReader();switch(r){case"text":{let e=K(),t={id:d(),createdAt:new Date,role:"assistant",content:""};for(;;){let{done:r,value:o}=await y.read();if(r)break;if(t.content+=e(o),i([{...t}],[]),(null==a?void 0:a())===null){y.cancel();break}}return null==c||c(t,{usage:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},finishReason:"unknown"}),{messages:[t],data:[]}}case"data":return await U({reader:y,abortControllerRef:null!=a?{current:a()}:void 0,update:i,onToolCall:u,onFinish({message:e,finishReason:t,usage:r}){c&&null!=e&&c(e,{usage:r,finishReason:t})},generateId:d});default:throw Error(`Unknown stream protocol: ${r}`)}}var $=()=>fetch;async function W({api:e,prompt:t,credentials:r,headers:o,body:n,streamProtocol:a="data",setCompletion:l,setLoading:s,setError:i,setAbortController:c,onResponse:u,onFinish:d,onError:f,onData:p,fetch:_=$()}){try{s(!0),i(void 0);let f=new AbortController;c(f),l("");let h=await _(e,{method:"POST",body:JSON.stringify({prompt:t,...n}),credentials:r,headers:{"Content-Type":"application/json",...o},signal:f.signal}).catch(e=>{throw e});if(u)try{await u(h)}catch(e){throw e}if(!h.ok)throw Error(await h.text()||"Failed to fetch the chat response.");if(!h.body)throw Error("The response body is empty.");let y="",g=h.body.getReader();switch(a){case"text":{let e=K();for(;;){let{done:t,value:r}=await g.read();if(t)break;if(y+=e(r),l(y),null===f){g.cancel();break}}break}case"data":for await(let{type:e,value:t}of B(g,{isAborted:()=>null===f}))switch(e){case"text":y+=t,l(y);break;case"data":null==p||p(t)}break;default:throw Error(`Unknown stream protocol: ${a}`)}return d&&d(t,y),c(null),y}catch(e){if("AbortError"===e.name)return c(null),null;e instanceof Error&&f&&f(e),i(e)}finally{s(!1)}}function K(e){let t=new TextDecoder;return e?function(e){return t.decode(e,{stream:!0}).split("\n").filter(e=>""!==e).map(M).filter(Boolean)}:function(e){return e?t.decode(e,{stream:!0}):""}}async function G({getStreamedResponse:e,experimental_onFunctionCall:t,experimental_onToolCall:r,updateChatRequest:o,getCurrentMessages:n}){for(;;){let a=await e();if("messages"in a){let e=!1;for(let l of a.messages)if(void 0!==l.function_call&&"string"!=typeof l.function_call||void 0!==l.tool_calls&&"string"!=typeof l.tool_calls){if(e=!0,t){let r=l.function_call;if("object"!=typeof r){console.warn("experimental_onFunctionCall should not be defined when using tools");continue}let a=await t(n(),r);if(void 0===a){e=!1;break}o(a)}if(r){let t=l.tool_calls;if(!Array.isArray(t)||t.some(e=>"object"!=typeof e)){console.warn("experimental_onToolCall should not be defined when using tools");continue}let a=await r(n(),t);if(void 0===a){e=!1;break}o(a)}}if(!e)break}else{let e=function(e){for(let t of e.messages){if(void 0!==t.tool_calls)for(let e of t.tool_calls)"object"==typeof e&&e.function.arguments&&"string"!=typeof e.function.arguments&&(e.function.arguments=JSON.stringify(e.function.arguments));void 0!==t.function_call&&"object"==typeof t.function_call&&t.function_call.arguments&&"string"!=typeof t.function_call.arguments&&(t.function_call.arguments=JSON.stringify(t.function_call.arguments))}};if((void 0===a.function_call||"string"==typeof a.function_call)&&(void 0===a.tool_calls||"string"==typeof a.tool_calls))break;if(t){let r=a.function_call;if("object"!=typeof r){console.warn("experimental_onFunctionCall should not be defined when using tools");continue}let l=await t(n(),r);if(void 0===l)break;e(l),o(l)}if(r){let t=a.tool_calls;if("object"!=typeof t){console.warn("experimental_onToolCall should not be defined when using functions");continue}let l=await r(n(),t);if(void 0===l)break;e(l),o(l)}}}}Symbol.for("vercel.ai.schema");var q=r(1633);let z=()=>{},H=z(),Q=Object,X=e=>e===H,Z=e=>"function"==typeof e,ee=(e,t)=>({...e,...t}),et=e=>Z(e.then),er=new WeakMap,eo=0,en=e=>{let t,r;let o=typeof e,n=e&&e.constructor,a=n==Date;if(Q(e)!==e||a||n==RegExp)t=a?e.toJSON():"symbol"==o?e.toString():"string"==o?JSON.stringify(e):""+e;else{if(t=er.get(e))return t;if(t=++eo+"~",er.set(e,t),n==Array){for(r=0,t="@";r<e.length;r++)t+=en(e[r])+",";er.set(e,t)}if(n==Q){t="#";let o=Q.keys(e).sort();for(;!X(r=o.pop());)X(e[r])||(t+=r+":"+en(e[r])+",");er.set(e,t)}}return t},ea=new WeakMap,el={},es={},ei="undefined",ec=typeof window!=ei,eu=typeof document!=ei,ed=()=>ec&&typeof window.requestAnimationFrame!=ei,ef=(e,t)=>{let r=ea.get(e);return[()=>!X(t)&&e.get(t)||el,o=>{if(!X(t)){let n=e.get(t);t in es||(es[t]=n),r[5](t,ee(n,o),n||el)}},r[6],()=>!X(t)&&t in es?es[t]:!X(t)&&e.get(t)||el]},ep=!0,[e_,eh]=ec&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[z,z],ey={initFocus:e=>(eu&&document.addEventListener("visibilitychange",e),e_("focus",e),()=>{eu&&document.removeEventListener("visibilitychange",e),eh("focus",e)}),initReconnect:e=>{let t=()=>{ep=!0,e()},r=()=>{ep=!1};return e_("online",t),e_("offline",r),()=>{eh("online",t),eh("offline",r)}}},eg=!l.useId,em=!ec||"Deno"in window,eE=e=>ed()?window.requestAnimationFrame(e):setTimeout(e,1),eb=em?l.useEffect:l.useLayoutEffect,eI="undefined"!=typeof navigator&&navigator.connection,ev=!em&&eI&&(["slow-2g","2g"].includes(eI.effectiveType)||eI.saveData),ew=e=>{if(Z(e))try{e=e()}catch(t){e=""}let t=e;return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?en(e):"",t]},eT=0,eA=()=>++eT;var eR={ERROR_REVALIDATE_EVENT:3,FOCUS_EVENT:0,MUTATE_EVENT:2,RECONNECT_EVENT:1};async function eS(...e){let[t,r,o,n]=e,a=ee({populateCache:!0,throwOnError:!0},"boolean"==typeof n?{revalidate:n}:n||{}),l=a.populateCache,s=a.rollbackOnError,i=a.optimisticData,c=e=>"function"==typeof s?s(e):!1!==s,u=a.throwOnError;if(Z(r)){let e=[];for(let o of t.keys())!/^\$(inf|sub)\$/.test(o)&&r(t.get(o)._k)&&e.push(o);return Promise.all(e.map(d))}return d(r);async function d(r){let n;let[s]=ew(r);if(!s)return;let[d,f]=ef(t,s),[p,_,h,y]=ea.get(t),g=()=>{let e=p[s];return(Z(a.revalidate)?a.revalidate(d().data,r):!1!==a.revalidate)&&(delete h[s],delete y[s],e&&e[0])?e[0](2).then(()=>d().data):d().data};if(e.length<3)return g();let m=o,E=eA();_[s]=[E,0];let b=!X(i),I=d(),v=I.data,w=I._c,T=X(w)?v:w;if(b&&f({data:i=Z(i)?i(T,v):i,_c:T}),Z(m))try{m=m(T)}catch(e){n=e}if(m&&et(m)){if(m=await m.catch(e=>{n=e}),E!==_[s][0]){if(n)throw n;return m}n&&b&&c(n)&&(l=!0,f({data:T,_c:H}))}if(l&&!n&&(Z(l)?f({data:l(m,T),error:H,_c:H}):f({data:m,error:H,_c:H})),_[s][1]=eA(),Promise.resolve(g()).then(()=>{f({_c:H})}),n){if(u)throw n;return}return m}}let ek=(e,t)=>{for(let r in e)e[r][0]&&e[r][0](t)},eN=(e,t)=>{if(!ea.has(e)){let r=ee(ey,t),o={},n=eS.bind(H,e),a=z,l={},s=(e,t)=>{let r=l[e]||[];return l[e]=r,r.push(t),()=>r.splice(r.indexOf(t),1)},i=(t,r,o)=>{e.set(t,r);let n=l[t];if(n)for(let e of n)e(r,o)},c=()=>{if(!ea.has(e)&&(ea.set(e,[o,{},{},{},n,i,s]),!em)){let t=r.initFocus(setTimeout.bind(H,ek.bind(H,o,0))),n=r.initReconnect(setTimeout.bind(H,ek.bind(H,o,1)));a=()=>{t&&t(),n&&n(),ea.delete(e)}}};return c(),[e,n,c,a]}return[e,ea.get(e)[4]]},[ex,eC]=eN(new Map),eO=ee({onLoadingSlow:z,onSuccess:z,onError:z,onErrorRetry:(e,t,r,o,n)=>{let a=r.errorRetryCount,l=n.retryCount,s=~~((Math.random()+.5)*(1<<(l<8?l:8)))*r.errorRetryInterval;(X(a)||!(l>a))&&setTimeout(o,s,n)},onDiscarded:z,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:ev?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:ev?5e3:3e3,compare:(e,t)=>en(e)==en(t),isPaused:()=>!1,cache:ex,mutate:eC,fallback:{}},{isOnline:()=>ep,isVisible:()=>{let e=eu&&document.visibilityState;return X(e)||"hidden"!==e}}),eD=(e,t)=>{let r=ee(e,t);if(t){let{use:o,fallback:n}=e,{use:a,fallback:l}=t;o&&a&&(r.use=o.concat(a)),n&&l&&(r.fallback=ee(n,l))}return r},eL=(0,l.createContext)({}),eF=ec&&window.__SWR_DEVTOOLS_USE__,ej=eF?window.__SWR_DEVTOOLS_USE__:[],eV=e=>Z(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}],eM=()=>ee(eO,(0,l.useContext)(eL)),eB=ej.concat(e=>(t,r,o)=>{let n=r&&((...e)=>{let[o]=ew(t),[,,,n]=ea.get(ex);if(o.startsWith("$inf$"))return r(...e);let a=n[o];return X(a)?r(...e):(delete n[o],a)});return e(t,n,o)}),eJ=(e,t,r)=>{let o=t[e]||(t[e]=[]);return o.push(r),()=>{let e=o.indexOf(r);e>=0&&(o[e]=o[o.length-1],o.pop())}};eF&&(window.__SWR_DEVTOOLS_REACT__=l);let eU=l.use||(e=>{if("pending"===e.status)throw e;if("fulfilled"===e.status)return e.value;if("rejected"===e.status)throw e.reason;throw e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}),e}),eP={dedupe:!0};Q.defineProperty(e=>{let{value:t}=e,r=(0,l.useContext)(eL),o=Z(t),n=(0,l.useMemo)(()=>o?t(r):t,[o,r,t]),a=(0,l.useMemo)(()=>o?n:eD(r,n),[o,r,n]),s=n&&n.provider,i=(0,l.useRef)(H);s&&!i.current&&(i.current=eN(s(a.cache||ex),n));let c=i.current;return c&&(a.cache=c[0],a.mutate=c[1]),eb(()=>{if(c)return c[2]&&c[2](),c[3]},[]),(0,l.createElement)(eL.Provider,ee(e,{value:a}))},"defaultValue",{value:eO});let eY=(o=(e,t,r)=>{let{cache:o,compare:n,suspense:a,fallbackData:s,revalidateOnMount:i,revalidateIfStale:c,refreshInterval:u,refreshWhenHidden:d,refreshWhenOffline:f,keepPreviousData:p}=r,[_,h,y,g]=ea.get(o),[m,E]=ew(e),b=(0,l.useRef)(!1),I=(0,l.useRef)(!1),v=(0,l.useRef)(m),w=(0,l.useRef)(t),T=(0,l.useRef)(r),A=()=>T.current,R=()=>A().isVisible()&&A().isOnline(),[S,k,N,x]=ef(o,m),C=(0,l.useRef)({}).current,O=X(s)?r.fallback[m]:s,D=(e,t)=>{for(let r in C)if("data"===r){if(!n(e[r],t[r])&&(!X(e[r])||!n(P,t[r])))return!1}else if(t[r]!==e[r])return!1;return!0},L=(0,l.useMemo)(()=>{let e=!!m&&!!t&&(X(i)?!A().isPaused()&&!a&&(!!X(c)||c):i),r=t=>{let r=ee(t);return(delete r._k,e)?{isValidating:!0,isLoading:!0,...r}:r},o=S(),n=x(),l=r(o),s=o===n?l:r(n),u=l;return[()=>{let e=r(S());return D(e,u)?(u.data=e.data,u.isLoading=e.isLoading,u.isValidating=e.isValidating,u.error=e.error,u):(u=e,e)},()=>s]},[o,m]),F=(0,q.useSyncExternalStore)((0,l.useCallback)(e=>N(m,(t,r)=>{D(r,t)||e()}),[o,m]),L[0],L[1]),j=!b.current,V=_[m]&&_[m].length>0,M=F.data,B=X(M)?O:M,J=F.error,U=(0,l.useRef)(B),P=p?X(M)?U.current:M:B,Y=(!V||!!X(J))&&(j&&!X(i)?i:!A().isPaused()&&(a?!X(B)&&c:X(B)||c)),$=!!(m&&t&&j&&Y),W=X(F.isValidating)?$:F.isValidating,K=X(F.isLoading)?$:F.isLoading,G=(0,l.useCallback)(async e=>{let t,o;let a=w.current;if(!m||!a||I.current||A().isPaused())return!1;let l=!0,s=e||{},i=!y[m]||!s.dedupe,c=()=>eg?!I.current&&m===v.current&&b.current:m===v.current,u={isValidating:!1,isLoading:!1},d=()=>{k(u)},f=()=>{let e=y[m];e&&e[1]===o&&delete y[m]},p={isValidating:!0};X(S().data)&&(p.isLoading=!0);try{if(i&&(k(p),r.loadingTimeout&&X(S().data)&&setTimeout(()=>{l&&c()&&A().onLoadingSlow(m,r)},r.loadingTimeout),y[m]=[a(E),eA()]),[t,o]=y[m],t=await t,i&&setTimeout(f,r.dedupingInterval),!y[m]||y[m][1]!==o)return i&&c()&&A().onDiscarded(m),!1;u.error=H;let e=h[m];if(!X(e)&&(o<=e[0]||o<=e[1]||0===e[1]))return d(),i&&c()&&A().onDiscarded(m),!1;let s=S().data;u.data=n(s,t)?s:t,i&&c()&&A().onSuccess(t,m,r)}catch(r){f();let e=A(),{shouldRetryOnError:t}=e;!e.isPaused()&&(u.error=r,i&&c()&&(e.onError(r,m,e),(!0===t||Z(t)&&t(r))&&(!A().revalidateOnFocus||!A().revalidateOnReconnect||R())&&e.onErrorRetry(r,m,e,e=>{let t=_[m];t&&t[0]&&t[0](eR.ERROR_REVALIDATE_EVENT,e)},{retryCount:(s.retryCount||0)+1,dedupe:!0})))}return l=!1,d(),!0},[m,o]),z=(0,l.useCallback)((...e)=>eS(o,v.current,...e),[]);if(eb(()=>{w.current=t,T.current=r,X(M)||(U.current=M)}),eb(()=>{if(!m)return;let e=G.bind(H,eP),t=0,r=eJ(m,_,(r,o={})=>{if(r==eR.FOCUS_EVENT){let r=Date.now();A().revalidateOnFocus&&r>t&&R()&&(t=r+A().focusThrottleInterval,e())}else if(r==eR.RECONNECT_EVENT)A().revalidateOnReconnect&&R()&&e();else if(r==eR.MUTATE_EVENT)return G();else if(r==eR.ERROR_REVALIDATE_EVENT)return G(o)});return I.current=!1,v.current=m,b.current=!0,k({_k:E}),Y&&(X(B)||em?e():eE(e)),()=>{I.current=!0,r()}},[m]),eb(()=>{let e;function t(){let t=Z(u)?u(S().data):u;t&&-1!==e&&(e=setTimeout(r,t))}function r(){!S().error&&(d||A().isVisible())&&(f||A().isOnline())?G(eP).then(t):t()}return t(),()=>{e&&(clearTimeout(e),e=-1)}},[u,d,f,m]),(0,l.useDebugValue)(P),a&&X(B)&&m){if(!eg&&em)throw Error("Fallback data is required when using suspense in SSR.");w.current=t,T.current=r,I.current=!1;let e=g[m];if(X(e)||eU(z(e)),X(J)){let e=G(eP);X(P)||(e.status="fulfilled",e.value=!0),eU(e)}else throw J}return{mutate:z,get data(){return C.data=!0,P},get error(){return C.error=!0,J},get isValidating(){return C.isValidating=!0,W},get isLoading(){return C.isLoading=!0,K}}},function(...e){let t=eM(),[r,n,a]=eV(e),l=eD(t,a),s=o,{use:i}=l,c=(i||[]).concat(eB);for(let e=c.length;e--;)s=c[e](s);return s(r,n||l.fetcher||null,l)});var e$=r(32631);function eW(e,t){return null!=t?e$(e,t):e}var eK=async(e,t,r,o,n,a,l,s,i,c,u,d,f,p,_,h,y)=>{var g;let m=l.current;r(t.messages,!1);let E=p?t.messages:t.messages.map(({role:e,content:t,experimental_attachments:r,name:o,data:n,annotations:a,toolInvocations:l,function_call:s,tool_calls:i,tool_call_id:c})=>({role:e,content:t,...void 0!==r&&{experimental_attachments:r},...void 0!==o&&{name:o},...void 0!==n&&{data:n},...void 0!==a&&{annotations:a},...void 0!==l&&{toolInvocations:l},tool_call_id:c,...void 0!==s&&{function_call:s},...void 0!==i&&{tool_calls:i}})),b=n.current;return await Y({api:e,body:null!=(g=null==_?void 0:_({messages:t.messages,requestData:t.data,requestBody:t.body}))?g:{messages:E,data:t.data,...a.current.body,...t.body,...void 0!==t.functions&&{functions:t.functions},...void 0!==t.function_call&&{function_call:t.function_call},...void 0!==t.tools&&{tools:t.tools},...void 0!==t.tool_choice&&{tool_choice:t.tool_choice}},streamProtocol:c,credentials:a.current.credentials,headers:{...a.current.headers,...t.headers},abortController:()=>s.current,restoreMessagesOnFailure(){y||r(m,!1)},onResponse:d,onUpdate(e,n){r([...t.messages,...e],!1),o([...null!=b?b:[],...null!=n?n:[]],!1)},onToolCall:f,onFinish:u,generateId:i,fetch:h})};function eG(e){return"assistant"===e.role&&e.toolInvocations&&e.toolInvocations.length>0&&e.toolInvocations.every(e=>"result"in e)}async function eq(e){if(null==e)return[];if(e instanceof FileList)return Promise.all(Array.from(e).map(async e=>{let{name:t,type:r}=e;return{name:t,contentType:r,url:await new Promise((t,r)=>{let o=new FileReader;o.onload=e=>{var r;t(null==(r=e.target)?void 0:r.result)},o.onerror=e=>r(e),o.readAsDataURL(e)})}}));if(Array.isArray(e))return e;throw Error("Invalid attachments type")}var ez=function({api:e="/api/chat",id:t,initialMessages:r,initialInput:o="",sendExtraMessageFields:n,experimental_onFunctionCall:a,experimental_onToolCall:s,onToolCall:i,experimental_prepareRequestBody:c,experimental_maxAutomaticRoundtrips:u=0,maxAutomaticRoundtrips:d=u,maxToolRoundtrips:f=d,maxSteps:p=null!=f?f+1:1,streamMode:_,streamProtocol:h,onResponse:y,onFinish:m,onError:E,credentials:b,headers:I,body:v,generateId:w=g,fetch:T,keepLastMessageOnError:A=!1,experimental_throttle:R}={}){_&&(null!=h||(h="text"===_?"text":void 0));let S=(0,l.useId)(),k=null!=t?t:S,N="string"==typeof e?[e,k]:k,[x]=(0,l.useState)([]),{data:C,mutate:O}=eY([N,"messages"],null,{fallbackData:null!=r?r:x}),D=(0,l.useRef)(C||[]);(0,l.useEffect)(()=>{D.current=C||[]},[C]);let{data:L,mutate:F}=eY([N,"streamData"],null),j=(0,l.useRef)(L);(0,l.useEffect)(()=>{j.current=L},[L]);let{data:V=!1,mutate:M}=eY([N,"loading"],null),{data:B,mutate:J}=eY([N,"error"],null),U=(0,l.useRef)(null),P=(0,l.useRef)({credentials:b,headers:I,body:v});(0,l.useEffect)(()=>{P.current={credentials:b,headers:I,body:v}},[b,I,v]);let Y=(0,l.useCallback)(async t=>{let r=D.current.length;try{M(!0),J(void 0);let r=new AbortController;U.current=r,await G({getStreamedResponse:()=>eK(e,t,eW(O,R),eW(F,R),j,P,D,U,w,h,m,y,i,n,c,T,A),experimental_onFunctionCall:a,experimental_onToolCall:s,updateChatRequest:e=>{t=e},getCurrentMessages:()=>D.current}),U.current=null}catch(e){if("AbortError"===e.name)return U.current=null,null;E&&e instanceof Error&&E(e),J(e)}finally{M(!1)}let o=D.current,l=o[o.length-1];o.length>r&&null!=l&&p>1&&eG(l)&&function(e){let t=0;for(let r=e.length-1;r>=0;r--)if("assistant"===e[r].role)t++;else break;return t}(o)<p&&await Y({messages:o})},[O,M,e,P,y,m,E,J,F,j,h,n,a,s,c,i,p,D,U,w,T,A,R]),$=(0,l.useCallback)(async(e,{options:t,functions:r,function_call:o,tools:n,tool_choice:a,data:l,headers:s,body:i,experimental_attachments:c}={})=>{var u,d;e.id||(e.id=w());let f=await eq(c),p={headers:null!=s?s:null==t?void 0:t.headers,body:null!=i?i:null==t?void 0:t.body};return Y({messages:D.current.concat({...e,id:null!=(u=e.id)?u:w(),createdAt:null!=(d=e.createdAt)?d:new Date,experimental_attachments:f.length>0?f:void 0}),options:p,headers:p.headers,body:p.body,data:l,...void 0!==r&&{functions:r},...void 0!==o&&{function_call:o},...void 0!==n&&{tools:n},...void 0!==a&&{tool_choice:a}})},[Y,w]),W=(0,l.useCallback)(async({options:e,functions:t,function_call:r,tools:o,tool_choice:n,data:a,headers:l,body:s}={})=>{if(0===D.current.length)return null;let i={headers:null!=l?l:null==e?void 0:e.headers,body:null!=s?s:null==e?void 0:e.body};return"assistant"===D.current[D.current.length-1].role?Y({messages:D.current.slice(0,-1),options:i,headers:i.headers,body:i.body,data:a,...void 0!==t&&{functions:t},...void 0!==r&&{function_call:r},...void 0!==o&&{tools:o},...void 0!==n&&{tool_choice:n}}):Y({messages:D.current,options:i,headers:i.headers,body:i.body,data:a,...void 0!==t&&{functions:t},...void 0!==r&&{function_call:r},...void 0!==o&&{tools:o},...void 0!==n&&{tool_choice:n}})},[Y]),K=(0,l.useCallback)(()=>{U.current&&(U.current.abort(),U.current=null)},[]),q=(0,l.useCallback)(e=>{"function"==typeof e&&(e=e(D.current)),O(e,!1),D.current=e},[O]),z=(0,l.useCallback)(e=>{"function"==typeof e&&(e=e(j.current)),F(e,!1),j.current=e},[F]),[H,Q]=(0,l.useState)(o),X=(0,l.useCallback)(async(e,t={},r)=>{var o,n,a,l,s;if(null==(o=null==e?void 0:e.preventDefault)||o.call(e),!H&&!t.allowEmptySubmit)return;r&&(P.current={...P.current,...r});let i=await eq(t.experimental_attachments),c={headers:null!=(a=t.headers)?a:null==(n=t.options)?void 0:n.headers,body:null!=(s=t.body)?s:null==(l=t.options)?void 0:l.body};Y({messages:H||i.length||!t.allowEmptySubmit?D.current.concat({id:w(),createdAt:new Date,role:"user",content:H,experimental_attachments:i.length>0?i:void 0}):D.current,options:c,headers:c.headers,body:c.body,data:t.data}),Q("")},[H,w,Y]),Z=({toolCallId:e,result:t})=>{let r=D.current.map((r,o,n)=>o===n.length-1&&"assistant"===r.role&&r.toolInvocations?{...r,toolInvocations:r.toolInvocations.map(r=>r.toolCallId===e?{...r,result:t}:r)}:r);O(r,!1),eG(r[r.length-1])&&Y({messages:r})};return{messages:C||[],setMessages:q,data:L,setData:z,error:B,append:$,reload:W,stop:K,input:H,setInput:Q,handleInputChange:e=>{Q(e.target.value)},handleSubmit:X,isLoading:V,addToolResult:Z,experimental_addToolResult:Z}},eH=function({api:e="/api/completion",id:t,initialCompletion:r="",initialInput:o="",credentials:n,headers:a,body:s,streamMode:i,streamProtocol:c,fetch:u,onResponse:d,onFinish:f,onError:p,experimental_throttle:_}={}){i&&(null!=c||(c="text"===i?"text":void 0));let h=(0,l.useId)(),y=t||h,{data:g,mutate:m}=eY([e,y],null,{fallbackData:r}),{data:E=!1,mutate:b}=eY([y,"loading"],null),{data:I,mutate:v}=eY([y,"streamData"],null),[w,T]=(0,l.useState)(void 0),[A,R]=(0,l.useState)(null),S=(0,l.useRef)({credentials:n,headers:a,body:s});(0,l.useEffect)(()=>{S.current={credentials:n,headers:a,body:s}},[n,a,s]);let k=(0,l.useCallback)(async(t,r)=>W({api:e,prompt:t,credentials:S.current.credentials,headers:{...S.current.headers,...null==r?void 0:r.headers},body:{...S.current.body,...null==r?void 0:r.body},streamProtocol:c,fetch:u,setCompletion:eW(e=>m(e,!1),_),onData:eW(e=>v([...null!=I?I:[],...null!=e?e:[]],!1),_),setLoading:b,setError:T,setAbortController:R,onResponse:d,onFinish:f,onError:p}),[m,b,e,S,R,d,f,p,T,I,c,u,v,_]),N=(0,l.useCallback)(()=>{A&&(A.abort(),R(null))},[A]),x=(0,l.useCallback)(e=>{m(e,!1)},[m]),C=(0,l.useCallback)(async(e,t)=>k(e,t),[k]),[O,D]=(0,l.useState)(o),L=(0,l.useCallback)(e=>{var t;return null==(t=null==e?void 0:e.preventDefault)||t.call(e),O?C(O):void 0},[O,C]),F=(0,l.useCallback)(e=>{D(e.target.value)},[D]);return{completion:g,complete:C,error:w,setCompletion:x,stop:N,input:O,setInput:D,handleInputChange:F,handleSubmit:L,isLoading:E,data:I}}}}]);